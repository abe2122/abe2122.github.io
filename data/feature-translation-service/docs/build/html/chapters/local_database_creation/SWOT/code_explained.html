

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Code Explained &mdash; feature-translation-service  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Tutorial Overview" href="../../migrating_to_aws/tutorial/overview.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> feature-translation-service
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/downloading.html">Downloading the Data</a></li>
</ul>
<p class="caption"><span class="caption-text">HUC Database Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../HUC/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HUC/overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HUC/overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HUC/code_explained.html">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">SWOT Database Creation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating HUC to AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/tutorial/overview.html">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/tutorial/create_db.html">Creating an AWS Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/tutorial/lambda.html">Create Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/tutorial/api_gateway.html">API Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/tutorial/lambda_explained.html">Lambda Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating SWOT to AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/swot_tutorial/overview.html">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating_to_aws/swot_tutorial/overview.html#similarities-differences-to-huc">Similarities/Differences to HUC</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/huc/querying.html">Querying the HUC Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/swot/querying.html">Querying the SWOT Dataset</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">feature-translation-service</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Code Explained</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/chapters/local_database_creation/SWOT/code_explained.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="code-explained">
<h1>Code Explained<a class="headerlink" href="#code-explained" title="Permalink to this headline">¶</a></h1>
<p>This section will purely be dedicated to me explaining some of the code within the <em>SWOT Database Creation</em> that might need more clarification than just a comment in the code. I’ve attempted to structure the SWOT code in a way that makes it incredibly similar to that of the HUC code. This way, you’ll be able to more easily see the differing approaches taken. Creating the SWOT database will not require any simplification algorithms, as the data contained will only be linestrings and points.</p>
<p>In addition to this section, I’ve provided a Jupyter notebook that will allow you to create and visualize some of the SWOT data included in the SWORD database.</p>
<hr class="docutils" />
<hr class="docutils" />
<p>Within <em>parse_SWOT.py</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove indices that are negative. Maybe a mistake in the SWORD database?</span>
<span class="c1"># Only ~600 / 10,000,000 have this negative.</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Pad each column with zeros for same length</span>
<span class="c1"># SegID: 1234 -&gt; 1234</span>
<span class="c1"># SegID: 1 -&gt; 0001</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;basin_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;basin_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># Create SWOT Feature ID according to standard concatenation of:</span>
<span class="c1"># continent code + basin code + reach + node + lakeflag</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;SWOT_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;basin_code&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lakeflag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p>The code above is used to create the SWOT Feature ID according to the following standard:</p>
<p><img alt="../../../_images/feature_id.png" src="../../../_images/feature_id.png" /></p>
<p>First though, there were ~600 of the ~10,000,000 points that had <em>negative</em> segment indices. This is shown more in depth in the associated Jupyter notebook. I’m not entirely sure if this is intended behavior, as this sort of defeats the purpose of having one unified SWOT Feature ID (as concatenating a negative seems unintuitive). At this point, I’m assuming these are unintentional, and have removed them from the final database using the first line of code above.</p>
<p>The following three lines are used to ensure each SWOT Feature ID has the same length.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pad each column with zeros for same length</span>
<span class="c1"># SegID: 1234 -&gt; 1234</span>
<span class="c1"># SegID: 1 -&gt; 0001</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;basin_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;basin_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;segInd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>For example, in the following table, you can see where concatenating would cause a mismatch in lengths:</p>
<center><table border="1" class="docutils">
<thead>
<tr>
<th align="center">Basin Code</th>
<th align="center">Segment ID</th>
<th align="center">Segment Index</th>
<th align="center">Lake Flag</th>
<th align="center">SWOT Feature ID</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">799080</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">79908011</td>
</tr>
<tr>
<td align="center">799080</td>
<td align="center">7637</td>
<td align="center">26872</td>
<td align="center">0</td>
<td align="center">799080763726872</td>
</tr>
</tbody>
</table></center><p>In order to standardize this SWOT Feature ID, I’ve padded each value to the max number of digits required per column. This is similar to the picture above, however we required 4 digits for the Segment ID and 5 for the Segment Index. Thus the values in the table above would be modified to:</p>
<center><table border="1" class="docutils">
<thead>
<tr>
<th align="center">Basin Code</th>
<th align="center">Segment ID</th>
<th align="center">Segment Index</th>
<th align="center">Lake Flag</th>
<th align="center">SWOT Feature ID</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">799080</td>
<td align="center">0001</td>
<td align="center">00001</td>
<td align="center">0</td>
<td align="center">799080000100001</td>
</tr>
<tr>
<td align="center">799080</td>
<td align="center">7637</td>
<td align="center">26872</td>
<td align="center">0</td>
<td align="center">799080763726872</td>
</tr>
</tbody>
</table></center><p>The final line of code combines each column into the final SWOT Feature ID seen above.</p>
<hr class="docutils" />
<p>Since no simplification was necessary, the code for the SWOT database creation was much simpler than the HUC creation code. The <em>create_SWOT_dataset.py</em> code is relatively similar to that of the <em>create_HUC_dataset.py</em> code, thus I’ll skip going into detail about it.</p>
<hr class="docutils" />
<p>As a final note, this is the entire <em>SWORD</em> database plotted to give you a better idea of what you’re working with:</p>
<p><img alt="../../../_images/entire_pic.png" src="../../../_images/entire_pic.png" /></p>
<p>and a subset of what is created from the <em>create_SWOT_dataset.py</em> file can be seen below:</p>
<center><p><img alt="../../../_images/swot_db.png" src="../../../_images/swot_db.png" /></p>
</center></div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../migrating_to_aws/tutorial/overview.html" class="btn btn-neutral float-right" title="Tutorial Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>