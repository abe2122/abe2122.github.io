

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API Gateway &mdash; feature-translation-service  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Lambda Explained" href="lambda_explained.html" />
    <link rel="prev" title="Create Lambda" href="lambda.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> feature-translation-service
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/downloading.html">Downloading the Data</a></li>
</ul>
<p class="caption"><span class="caption-text">HUC Database Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/code_explained.html">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">SWOT Database Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/code_explained.html">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating HUC to AWS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_db.html">Creating an AWS Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html">Create Lambda</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda_explained.html">Lambda Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating SWOT to AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../swot_tutorial/overview.html">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../swot_tutorial/overview.html#similarities-differences-to-huc">Similarities/Differences to HUC</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/huc/querying.html">Querying the HUC Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/swot/querying.html">Querying the SWOT Dataset</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">feature-translation-service</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>API Gateway</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/chapters/migrating_to_aws/tutorial/api_gateway.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api-gateway">
<h1>API Gateway<a class="headerlink" href="#api-gateway" title="Permalink to this headline">¶</a></h1>
<p>In the last section, we created our Lambda function and used it to query the HUC database we created. In this section, I’ll detail how I created an API Gateway in AWS. This way, users will be able to query the database from a <em>curl</em> statement in the command line.</p>
<p>There are several ways of doing this - from uploading OpenAPI 3.0 .yaml files, to creating your own on AWS itself. This will not nearly be as detailed as the two previous steps, as I feel <a class="reference external" href="https://www.lynda.com/Amazon-Web-Services-tutorials/Create-API-Lambda/746313/777907-4.html?autoplay=true">this Lynda series</a> does a fantastic job at explaining how to do this.</p>
<p><strong>Important:</strong> Again, there is an associated video tutorial for this documentation. In it I also go over how to create the API gateway for the feature translation service. The video can be found <a class="reference external" href="https://drive.google.com/open?id=1rNfWO3NuX53jynmMZaTi5JPj0FRvnNGp">here</a>. You can find my full API Gateway implementation <a class="reference external" href="https://us-west-2.console.aws.amazon.com/apigateway/home?region=us-west-2#/apis/g6zl7z2x7j/resources/rh3x3wg1nb">here</a>!</p>
<hr class="docutils" />
<p>Below is my baseline OpenAPI 3.0 “.yaml” file for API Gateway.</p>
<details><summary><span style="color:blue">Click to expand my OpenAPI 3.0 file:</span></summary>
<p><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>openapi: 3.0.0
info:
  title: huc-lambda-API
  description: API used for PO.DAAC feature translation service
  version: 0.1.0
paths:
  /huc/{huc}:
    get:
      operationId: gethuc
      parameters:
        - description: The ID of the HUC to return.
          in: path
          name: huc
          required: true
          schema:
            example: &quot;1701020108&quot;
            type: string
      responses:
        &#39;200&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/200&#39;
        &#39;400&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/400&#39;
        &#39;404&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/404&#39;
        &#39;413&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/413&#39;
      summary: Returns associated name and simplified polygon
  /region/{region}:
    get:
      operationId: getregion
      parameters:
        - description: The ID of the region to return.
          in: path
          name: region
          required: true
          schema:
            example: &quot;California Region&quot;
            type: string
      responses:
        &#39;200&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/200&#39;
        &#39;400&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/400&#39;
        &#39;404&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/404&#39;
        &#39;413&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/413&#39;
      summary: Returns associated HUC and simplified polygon.
components:
  schemas:
    200:
      description: 200 response from API
      properties:
        bounding_box:
          description: Bounding box for queried region.
          example: &quot;-121.63767546330098,37.04979849040802,-121.48073155937789,37.23308885991514&quot;
          type: string
        full_poly:
          description: Full USGS polygon location.
          example: {
                    s3: &quot;podaac-dev-feature-translation-service&quot;,
                    key: &quot;180500030105&quot;,
                    shpindex: &quot;12345&quot;
                   }
          type: object
        huc:
          description: HUC identifier for queried region.
          example: &quot;180500030105&quot;
          type: string
        polygon:
          description: Simplified polygon for queried region.
          example: &quot;-121.68307875802219,37.336883989962416,
                    -121.7034261236156,37.335436064964654,
                    -121.72219968921144,37.35039130244144,
                    -121.68307875802219,37.336883989962416&quot;
          type: string
        region:
          description: Region name for queried region.
          example: &quot;California Region&quot;
          type: string
      required:
        - bounding_box
        - full_poly
        - huc
        - polygon
        - region
      type: object
    400:
      description: 400 response from API
      properties:
        error:
          description: &quot;The specified URL is invalid (does not exist).&quot;
          type: string
      required:
        - error
      type: object
    404:
      description: 404 response from API
      properties:
        error:
          description: &quot;An entry with the specified region was not found.&quot;
          type: string
      required:
        - error
      type: object
    413:
      description: 413 response from API
      properties:
        error:
          description: &quot;413: Your query has returned is too large.&quot;
          type: string
      required:
        - error
      type: object
</pre></div>
</div>
</p>
</details>
<br/><br/><p>I modified it slightly through the AWS console however, so I’ve linked to my full implementation above.</p>
<p>The rest of the Lynda tutorial does a fairly thorough job at explaining how to create the API. That said, there are a few things that I personally found confusing:</p>
<ul class="simple">
<li><p>Passing parameters from API to Lambda</p></li>
<li><p>Integration/Method Responses</p></li>
</ul>
<p>After watching the Lynda tutorial, these will make more sense, but modifying these for your own application caused me some issues.</p>
<p>The purpose of API Gateway is essentially to map commands users can interpret to something that is queryable through the Lambda function. They sort of arbitrarily chose to create a model template to use, however I felt that sort of unnecessarily complicated a lot of things.</p>
<p>Also, the template they used would not work for other applications in general. So I scrapped their idea and went with a mapping of my own. For example, this is how the Integration Request mapping goes for a “HUC” query for me:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exact&quot;</span><span class="p">:</span><span class="s2">&quot;$input.params(&#39;exact&#39;)&quot;</span>
    <span class="s2">&quot;HUC&quot;</span><span class="p">:</span> <span class="s2">&quot;$input.params(&#39;huc&#39;)&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I’ve created a <strong>/{huc}</strong> resource with a “GET” request. Thus whatever HUC value I pass into
the API is assigned to $input.params(‘huc’), leaving you with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exact&quot;</span><span class="p">:</span><span class="s2">&quot;True&quot;</span>
    <span class="s2">&quot;HUC&quot;</span><span class="p">:</span> <span class="s2">&quot;12345678&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>for example.</p>
<hr class="docutils" />
<p>Also, the tutorial goes over Integration and Method Responses. These essentially just define how information returned from the Lambda function will be mapped back to more human-interpretable results for end-users. I personally formatted these responses within the Lambda function itself instead of using mapping templates. That said, I’m not sure if there is a performance hit from doing so.</p>
<p>If you followed my video tutorial <a class="reference external" href="https://drive.google.com/open?id=1rNfWO3NuX53jynmMZaTi5JPj0FRvnNGp">here</a> or the Lynda one <a class="reference external" href="https://www.lynda.com/Amazon-Web-Services-tutorials/Easy-RESTful-API-creation/746313/777888-4.html?autoplay=true">here</a>, you should now be ready to query information from the HUC database from a <em>curl</em> command.</p>
<p>The next <a class="reference internal" href="../../examples/overview.html"><span class="doc">Examples</span></a> section will take you through exactly how to do that with a few useful examples in Python.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lambda_explained.html" class="btn btn-neutral float-right" title="Lambda Explained" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lambda.html" class="btn btn-neutral float-left" title="Create Lambda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>