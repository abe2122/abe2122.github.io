

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial Overview &mdash; feature-translation-service  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="../../examples/overview.html" />
    <link rel="prev" title="Lambda Explained" href="../tutorial/lambda_explained.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> feature-translation-service
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/downloading.html">Downloading the Data</a></li>
</ul>
<p class="caption"><span class="caption-text">HUC Database Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/HUC/code_explained.html">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">SWOT Database Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html#creation-procedure">Creation Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/overview.html#run-the-code">Run the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../local_database_creation/SWOT/code_explained.html">Code Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating HUC to AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/overview.html">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/create_db.html">Creating an AWS Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/lambda.html">Create Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/api_gateway.html">API Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/lambda_explained.html">Lambda Explained</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating SWOT to AWS</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#similarities-differences-to-huc">Similarities/Differences to HUC</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/huc/querying.html">Querying the HUC Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/swot/querying.html">Querying the SWOT Dataset</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">feature-translation-service</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/chapters/migrating_to_aws/swot_tutorial/overview.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-overview">
<h1>Tutorial Overview<a class="headerlink" href="#tutorial-overview" title="Permalink to this headline">¶</a></h1>
<p>Migrating the SWOT database to AWS, creating the Lambda function, and creating the API Gateway was largely similar to the HUC procedure. For the most part, all that really varied was the Lambda function. Thus, if you follow the previous HUC steps, the changes detailed below should be relatively straightforward to implement if necessary.</p>
</div>
<div class="section" id="similarities-differences-to-huc">
<h1>Similarities/Differences to HUC<a class="headerlink" href="#similarities-differences-to-huc" title="Permalink to this headline">¶</a></h1>
<p>Database creation is unnecessary. Given we’ve already created the Feature Translation Service database in the HUC portion of this tutorial, we can just add a new table, naming it <em>swot_table</em> instead of <em>huc_table</em>. If you’ve created the <em>SWOT_Data.csv</em> file in the <a class="reference internal" href="../../local_database_creation/SWOT/overview.html"><span class="doc">SWOT Database Creation</span></a>, you can directly upload this to the FTS database using SequelPro (as done in the HUC portion) or through another mySQL tool. Doing so in SequelPro involves:</p>
<ul class="simple">
<li><p>File → Import</p></li>
<li><p>Navigate to <em>SWOT_Data.csv</em> file created earlier.</p></li>
<li><p>Ensure you’re not appending this to the HUC table by clicking the drop down menu in the top <em>right</em> and selecting <strong>New Table</strong>.</p></li>
<li><p>Set the ‘SWOT_Feature ID’ Target Field to a <em>VARCHAR(100)</em> and the ‘geometry’ field to <em>TEXT</em>.</p></li>
<li><p>Press <strong>Import</strong> in the bottom left.</p></li>
</ul>
<hr class="docutils" />
<p>As mentioned previously, the biggest change between the SWOT portion of the Feature Translation Service and the HUC portion is the Lambda function. You can find my Lambda code below:</p>
<details><summary><span style="color:blue">Click here for my Lambda code!</span></summary>
<p><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rds_config</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># Set up connection variables</span>
<span class="n">rds_host</span>  <span class="o">=</span> <span class="n">rds_config</span><span class="o">.</span><span class="n">db_endpoint</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">rds_config</span><span class="o">.</span><span class="n">db_username</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">rds_config</span><span class="o">.</span><span class="n">db_password</span>
<span class="n">db_name</span> <span class="o">=</span> <span class="n">rds_config</span><span class="o">.</span><span class="n">db_name</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">3306</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Connect to the mySQL database</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">rds_host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                           <span class="n">passwd</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db_name</span><span class="p">,</span> <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Unexpected error: Could not connect to MySql instance.&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SUCCESS: Connection to RDS mysql instance succeeded&quot;</span><span class="p">)</span>

<span class="c1">###########</span>

<span class="k">def</span> <span class="nf">format_json</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">swot_id</span><span class="p">,</span> <span class="n">exact</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>

    <span class="c1"># Fetch all results from mySQL query</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="c1"># ********** #</span>
    <span class="n">TO_JSON</span> <span class="o">=</span> <span class="bp">False</span>     <span class="c1"># Modify to &quot;True&quot; once CMR JSON POST support is available.</span>
    <span class="c1"># ********** #</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;404: Results with the specified SWOT Feature ID {} were not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">swot_id</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">5750000</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;413: Query exceeds 6MB with {} hits.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)))))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;200 OK&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;hits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)))</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ms.&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;search on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;SWOT Feature ID&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">:</span> <span class="n">exact</span><span class="p">}</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">TO_JSON</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># 1 result returned</span>
            <span class="c1"># No need for &quot;OR&quot; between multiple points</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">][</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">][</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">][</span><span class="s1">&#39;condition&#39;</span><span class="p">][</span><span class="s1">&#39;or&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># OR&#39;ing together multiple points. Single line for loop creates individual</span>
                <span class="c1"># dictionaries with point/vertex key/value pairs. So, for example, one iteration</span>
                <span class="c1"># will result in:</span>

                <span class="c1"># {point: [94.323423, 43.230432]}</span>

                <span class="c1"># This is done for each point/linestring returned, and the final result is added to a</span>
                <span class="c1"># giant list correctly formatted for CMR JSON POST request.</span>
                <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">][</span><span class="s1">&#39;condition&#39;</span><span class="p">][</span><span class="s1">&#39;or&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">[</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]]})</span>

        <span class="c1"># Since JSON POST&#39;ing support isn&#39;t currently available, this just returns</span>
        <span class="c1"># a CMR queryable list of all points used in the form:</span>

        <span class="c1"># point=100,20&amp;point=140,30... which can then be used like so:</span>

        <span class="c1"># &quot;https://cmr.earthdata.nasa.gov/search/collections?point=100,20&amp;point=140,30&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">swot_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Necessary as I&#39;m concatenating all query results returned. Default max</span>
        <span class="c1"># size is like 1024 characters, which isn&#39;t nearly enough.</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET group_concat_max_len = 100000000&quot;</span><span class="p">)</span>

        <span class="c1"># Searching on SWOT Feature ID</span>
        <span class="k">if</span> <span class="s2">&quot;SWOT_ID&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]:</span>

            <span class="c1"># User has given an &#39;exact&#39; value</span>
            <span class="k">if</span> <span class="s2">&quot;exact&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]:</span>

                <span class="c1"># User wants the query to be exact</span>
                <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;exact&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>

                    <span class="c1"># Return everything EQUAL to the input</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select GROUP_CONCAT(`geometry` SEPARATOR &#39;&amp;&#39;) from swot_table where `SWOT_ID` = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;SWOT_ID&#39;</span><span class="p">])</span>
                    <span class="n">exact</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="c1"># User wants partial matches (or misspelled &quot;true&quot;)</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># Search Feature IDs for similar results starting with user input.</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select GROUP_CONCAT(`geometry` SEPARATOR &#39;&amp;&#39;) from swot_table where `SWOT_ID` LIKE </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;SWOT_ID&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
                    <span class="n">exact</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c1"># User didn&#39;t given an &quot;exact&quot; value in API request</span>
            <span class="c1"># Assume exact = False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select GROUP_CONCAT(`geometry` SEPARATOR &#39;&amp;&#39;) from swot_table where `SWOT_ID` LIKE </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;SWOT_ID&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
                <span class="n">exact</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">format_json</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;SWOT_ID&#39;</span><span class="p">],</span> <span class="n">exact</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return 400 error assuming path is incorrect.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;400: The specified URL is invalid (does not exist).&quot;</span>
            <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</p>
</details> <br/><p>You’ll notice this is slightly shorter than the previous Lambda function as less formatting was necessary for the output.</p>
<p>In the exact same fashion as creating the HUC Lambda function, this would be zipped up and uploaded to AWS with the <em>pymysql</em> package.</p>
<hr class="docutils" />
<p>Creating test events is largely similar, however instead of looking like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exact&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;Woods Creek-Skykomish River&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>it might look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exact&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SWOT_ID&quot;</span><span class="p">:</span> <span class="s2">&quot;75411400010000&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Furthermore, within the API Gateway Integration Request, we’d format a mapping template to look like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exact&quot;</span><span class="p">:</span><span class="s2">&quot;$input.params(&#39;exact&#39;)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SWOT_ID&quot;</span><span class="p">:</span> <span class="s2">&quot;$input.params(&#39;swot&#39;)&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If this doesn’t make sense, I’d highly recommend watching the video tutorial I’ve done on this <a class="reference external" href="https://drive.google.com/open?id=1rNfWO3NuX53jynmMZaTi5JPj0FRvnNGp">here</a>, or go back and reread the HUC portion of the tutorial.</p>
<hr class="docutils" />
<p>Finally, I created a separate OpenAPI .yaml file for the SWOT Feature Translation Service found below:</p>
<details><summary><span style="color:blue">Click to expand my OpenAPI 3.0 file:</span></summary>
<p><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>openapi: 3.0.0
info:
  title: swot-lambda-API
  description: API used for PO.DAAC feature translation service
  version: 0.1.0
paths:
  /swot/{swot}:
    get:
      operationId: getswot
      parameters:
        - description: The SWOT Feature ID to return.
          in: path
          name: swot
          required: true
          schema:
            example: &quot;75411400010000&quot;
            type: string
      responses:
        &#39;200&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/200&#39;
        &#39;400&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/400&#39;
        &#39;404&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/404&#39;
        &#39;413&#39;:
          content:
            application/json:
              schema:
                $ref: &#39;#/components/schemas/413&#39;
      summary: Returns associated name and simplified polygon
components:
  schemas:
    200:
      description: 200 response from API
      properties:
        point_list:
          description: Point list for queried region.
          example: &quot;point=-83.62575151546879,9.252305471126416&amp;point=-83.62575352733344,9.252576533363468&quot;
          type: string
      required:
        - point_list
      type: object
    400:
      description: 400 response from API
      properties:
        error:
          description: &quot;The specified URL is invalid (does not exist).&quot;
          type: string
      required:
        - error
      type: object
    404:
      description: 404 response from API
      properties:
        error:
          description: &quot;An entry with the specified SWOT Feature ID was not found.&quot;
          type: string
      required:
        - error
      type: object
    413:
      description: 413 response from API
      properties:
        error:
          description: &quot;413: Your query has returned is too large.&quot;
          type: string
      required:
        - error
      type: object
</pre></div>
</div>
</p>
</details>
<br/><br/><p>That said, all of this was included in one API Gateway deployment stage that looks as follows:</p>
<center><p><img alt="../../../_images/deploy_stage.png" src="../../../_images/deploy_stage.png" /></p>
</center><p>So querying the API is identical to querying via HUC/region except instead of looking like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">g6zl7z2x7j</span><span class="o">.</span><span class="n">execute</span><span class="o">-</span><span class="n">api</span><span class="o">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">prod</span><span class="o">/</span><span class="n">huc</span><span class="o">/</span><span class="p">{</span><span class="n">huc</span><span class="p">}</span>
</pre></div>
</div>
<p>it looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">g6zl7z2x7j</span><span class="o">.</span><span class="n">execute</span><span class="o">-</span><span class="n">api</span><span class="o">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">prod</span><span class="o">/</span><span class="n">swot</span><span class="o">/</span><span class="p">{</span><span class="n">swot_feature_id</span><span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../examples/overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../tutorial/lambda_explained.html" class="btn btn-neutral float-left" title="Lambda Explained" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>